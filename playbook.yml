---
# run this playbook like so: `ansible-playbook playbook.yml --ask-pass --ask-become-pass`. The ask-pass bit is necessary until you've got your ssh key installed
- hosts: cluster-pis
  remote_user: ubuntu
  vars:
        # java_version discovered by running `apt-cache show openjdk-8-jre-headless` on the remote machine
        java_major_version: 8
        java_version: 8u77-b03-3ubuntu3
        ansible_architecture: armhf
        spark_user: spark
        spark_user_groups: [ubuntu]
  
  # try to install spark
  roles:
    - 
      role: azavea.spark
      become: true
      
  tasks:
    - name: test connection
      ping:
      
    #see https://github.com/ansible/ansible-modules-core/blob/devel/system/authorized_key.py
    - name: install ssh key
      authorized_key:
            user: ubuntu
            key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"
            state: present
            exclusive: true
    
...
